<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Jojo’s Pod — Works (Masonry CSS Grid)</title>
<style>
  :root{
    --bg: #f7f5f2;
    --accent: #144055;
    --muted: #666;
    --card-radius: 12px;
    --gap: 18px;
    /* 控制默认列数（会在 media queries 中覆盖） */
    --cols: 4;
    --row-height: 300; /* grid-auto-rows 单位为 px（JS 会换算） */
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: Inter, "Noto Sans SC", system-ui, -apple-system, "Helvetica Neue", Arial;
    background:var(--bg);
    color:#222;
    -webkit-font-smoothing:antialiased;
  }

  header{
    padding:28px 20px;
    display:flex;
    align-items:center;
    gap:16px;
    border-bottom:1px solid rgba(0,0,0,0.04);
    background:linear-gradient(180deg, rgba(255,255,255,0.7), transparent);
    position:sticky;
    top:0;
    z-index:10;
  }
  .logo{font-weight:700;color:var(--accent);font-size:18px}
  nav{margin-left:auto}
  nav a{color:var(--muted);text-decoration:none;margin-left:14px;font-size:14px}

  .hero{
    max-width:1200px;margin:18px auto;padding:14px 20px;
  }
  .hero h1{margin:0;color:var(--accent);font-size:20px}
  .hero p{margin:6px 0 0;color:var(--muted);font-size:14px}

  .controls{
    max-width:1200px;margin:12px auto;padding:10px 20px;display:flex;gap:10px;align-items:center;
  }
  .filters{display:flex;gap:8px;flex-wrap:wrap}
  .filters button{
    padding:8px 12px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);
    background:#fff;cursor:pointer;font-size:13px;color:var(--muted);
    transition:all .22s ease;
  }
  .filters button.active{color:var(--accent);border-color:var(--accent);font-weight:600}

  /* Grid container */
  .masonry-wrap{
    max-width:1400px;
    margin:0 auto;
    padding:0 20px 80px;
  }

  .masonry{
    display:grid;
    grid-template-columns: repeat(var(--cols), 1fr);
    gap: var(--gap);
    /* 每行基准高度，JS 用它来计算跨行数（单位 px） */
    grid-auto-rows: calc(var(--row-height) * 1px);
  }

  /* 每个卡片 */
  .card{
    background:#fff;
    border-radius:var(--card-radius);
    overflow:hidden;
    box-shadow: 0 6px 20px rgba(15,43,61,0.04);
    border:1px solid rgba(0,0,0,0.03);
    transition: transform .35s cubic-bezier(.2,.8,.2,1), box-shadow .35s ease, border-color .35s ease;
    display:flex;
    flex-direction:column;
  }

  .card:hover{
    transform: translateY(-8px);
    box-shadow: 0 18px 40px rgba(15,43,61,0.09);
    border-color: rgba(15,43,61,0.06);
  }

  .thumb{
    width:100%;
    display:block;
    /* 保证图片不溢出：容器会按图片真实高度流式撑高 */
  }

  .card .meta{
    padding:12px 14px;
    display:flex;
    gap:10px;
    align-items:center;
    justify-content:space-between;
    font-size:13px;color:var(--muted);
  }

  .card h3{
    margin:0;padding:0 14px 12px;font-size:16px;color:var(--accent);
    line-height:1.25;
  }
  .card p{margin:0;padding:0 14px 18px;color:#333;font-size:14px;line-height:1.45}

  /* category badges */
  .badge{
    display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;color:#fff;
  }
  .pod{background:#2b6fa3}
  .print{background:#b56a45}
  .paint{background:#4a8a5e}

  /* small helper for hidden cards during filter */
  .hidden{display:none !important;}

/* ========== Responsive 列数调整 ========== */
/* 4 列默认（桌面） */
@media (min-width: 1200px){
  :root{--cols:4}
}
/* 平板 / 宽窄桌面 3 列 */
@media (min-width: 900px) and (max-width:1199px){
  :root{--cols:3}
}
/* 小屏 2 列 */
@media (min-width: 600px) and (max-width:899px){
  :root{--cols:2}
}
/* 手机 1 列 */
@media (max-width:599px){
  :root{--cols:1}
}

/* 图片小动画（hover 图片微放大） */
.card img { display:block; width:100%; height:auto; transition: transform .8s ease; }
.card:hover img { transform: scale(1.035); }

/* page footer */
footer{padding:36px 20px;text-align:center;color:var(--muted);font-size:13px}
</style>
</head>
<body>

<header>
  <div class="logo">Jojo’s Pod</div>
  <nav><a href="#">About</a><a href="#">Works</a><a href="#">Contact</a></nav>
</header>

<section class="hero">
  <h1>Jojo’s Works — sound · print · painting</h1>
  <p>Three rhythms of one inquiry. Browse the experiments, prints, and small paintings.</p>
</section>

<div class="controls">
  <div class="filters" role="tablist" aria-label="filter">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="pod">Podcast</button>
    <button class="filter-btn" data-filter="print">Printworks</button>
    <button class="filter-btn" data-filter="paint">Paintings</button>
  </div>
</div>

<div class="masonry-wrap">
  <div class="masonry" id="masonry">
    <!-- card 示例：class 同时含类别 pod/print/paint -->
    <article class="card pod">
      <img class="thumb" src="https://picsum.photos/seed/ep6/900/600" alt="Ep6 Spiral">
      <div class="meta"><span class="badge pod">Podcast</span><span>Ep.6</span></div>
      <h3>Spiral to the Universe ~ 和弦陀螺</h3>
      <p>一段短小的音像实验：从五度链到对数螺线，轻轻旋转。</p>
    </article>

    <article class="card pod">
      <img class="thumb" src="https://picsum.photos/seed/ep5/700/600" alt="Ep5">
      <div class="meta"><span class="badge pod">Podcast</span><span>Ep.5</span></div>
      <h3>从薛定谔到一块橡皮章</h3>
      <p>关于物理、手作与记忆的小段思考。</p>
    </article>

    <article class="card print">
      <img class="thumb" src="https://picsum.photos/seed/print1/800/1200" alt="Print1">
      <div class="meta"><span class="badge print">Print</span><span>Print 01</span></div>
      <h3>铭记 · θεὸν περιφέρεις</h3>
      <p>书签与木刻的短辑，纪念性的图像小物。</p>
    </article>

    <article class="card paint">
      <img class="thumb" src="https://picsum.photos/seed/paint1/900/1100" alt="Paint1">
      <div class="meta"><span class="badge paint">Painting</span><span>Work A</span></div>
      <h3>二次生长 · 再生的姿态</h3>
      <p>亚麻布上的小画，关于时间与复苏。</p>
    </article>

    <!-- 继续添加更多卡片 -->
  </div>
</div>

<footer>© Jojo’s Pod — sound · print · painting</footer>

<script>
/*
  无库瀑布流实现思路：
  - 使用 CSS Grid + grid-auto-rows（一个小基准像素行）
  - JS 读取每个 card 实际高度（contentHeight），然后设置 card.style.gridRowEnd = 'span ' + Math.ceil(contentHeight / rowHeight)
  - 在图片加载完成、窗口resize时重新计算
*/

// 基准行高（px）——要与 CSS :root --row-height 对应
const baseRowPx = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--row-height')) || 8;

function resizeAllMasonryItems() {
  const grid = document.getElementById('masonry');
  if (!grid) return;
  const rowHeight = baseRowPx; // px per grid-auto-rows unit
  const rowGap = parseFloat(getComputedStyle(grid).getPropertyValue('gap')) || 18;

  const items = grid.querySelectorAll('.card:not(.hidden)');
  items.forEach(item => {
    // reset, force natural height
    item.style.gridRowEnd = "";
    const contentHeight = item.getBoundingClientRect().height;
    // compute how many rows to span (include gap in calculation)
    const total = contentHeight + rowGap;
    const rowSpan = Math.ceil(total / (rowHeight + rowGap));
    item.style.gridRowEnd = 'span ' + rowSpan;
  });
}

// 等待图片加载完成再测量
function waitForImagesThenLayout() {
  const grid = document.getElementById('masonry');
  const imgs = grid.querySelectorAll('img');
  let loaded = 0;
  if (imgs.length === 0) { resizeAllMasonryItems(); return; }
  imgs.forEach(img => {
    if (img.complete) {
      loaded++;
    } else {
      img.addEventListener('load', () => {
        loaded++;
        if (loaded === imgs.length) resizeAllMasonryItems();
      });
      img.addEventListener('error', () => {
        loaded++;
        if (loaded === imgs.length) resizeAllMasonryItems();
      });
    }
  });
  // in case all images were already complete
  if (loaded === imgs.length) resizeAllMasonryItems();
}

// 初次运行、窗口变化时重新布局（加防抖）
let resizeTimeout;
window.addEventListener('load', () => {
  waitForImagesThenLayout();
  // slight delay to let fonts render
  setTimeout(resizeAllMasonryItems, 300);
});

window.addEventListener('resize', () => {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(resizeAllMasonryItems, 150);
});

// 过滤逻辑（按钮）
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const f = btn.getAttribute('data-filter');
    const items = document.querySelectorAll('.masonry .card');
    items.forEach(it => {
      it.classList.remove('hidden');
      if (f !== 'all' && !it.classList.contains(f)) it.classList.add('hidden');
    });
    // 重新布局（稍等样式变化）
    setTimeout(resizeAllMasonryItems, 120);
  });
});

// 如果你之后动态添加卡片，记得调用 resizeAllMasonryItems()
// 例如： appendChild 后，等图片加载完再调用 waitForImagesThenLayout()
</script>

</body>
</html>
