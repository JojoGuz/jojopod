<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Jojo’s Pod — Adaptive Grid (Recommended)</title>
<style>
:root{
  --bg: #faf8f4;
  --accent: #1f4660;
  --muted: #666;
  --gap: 18px;
  --min-col: 240px;    /* 控制最小列宽，调整后列数随宽度变化 */
  --row-h: 8px;        /* 基准行高（px），JS 用它算跨度） */
}

*{box-sizing:border-box}
body{margin:0;font-family:Inter, "Noto Sans SC", system-ui, -apple-system, "Segoe UI", Roboto; background:var(--bg); color:#222}
.header{padding:22px 20px; display:flex; align-items:center; gap:16px; border-bottom:1px solid rgba(0,0,0,0.04)}
.logo{font-weight:700;color:var(--accent)}
.controls{max-width:1200px;margin:14px auto; padding:10px 20px; display:flex; gap:10px; align-items:center}
.controls .filters{display:flex; gap:8px; flex-wrap:wrap}
.controls button{padding:8px 12px;border-radius:999px;border:1px solid rgba(0,0,0,0.06); background:#fff; cursor:pointer; color:var(--muted)}
.controls button.active{border-color:var(--accent); color:var(--accent); font-weight:600}

/* Grid container */
.container{max-width:1400px;margin:0 auto;padding:0 20px 80px}
.grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(var(--min-col), 1fr));
  gap: var(--gap);
  grid-auto-rows: calc(var(--row-h) * 1px);
  align-items:start;
  padding-top:12px;
}

/* cards */
.card{background:#fff;border-radius:12px;overflow:hidden;border:1px solid rgba(0,0,0,0.03); box-shadow:0 6px 20px rgba(15,43,61,0.04); transition:transform .32s cubic-bezier(.2,.8,.2,1), box-shadow .32s}
.card:hover{transform:translateY(-8px); box-shadow:0 18px 40px rgba(15,43,61,0.09)}
.card img{display:block;width:100%;height:auto;transition:transform .7s ease}
.card:hover img{transform:scale(1.03)}
.meta{padding:12px 14px; display:flex; justify-content:space-between; align-items:center; font-size:13px; color:var(--muted)}
.title{margin:0;padding:0 14px 8px;color:var(--accent); font-size:16px}
.desc{margin:0;padding:0 14px 18px;color:#333;font-size:14px; line-height:1.45}

/* badges */
.badge{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;color:#fff}
.pod{background:#2b6fa3} .print{background:#b56a45} .paint{background:#4a8a5e}

/* hidden for filtering */
.hidden{display:none !important}

/* small-screen tweak */
@media (max-width:700px){:root{--min-col:180px}}
</style>
</head>
<body>

<header class="header">
  <div class="logo">Jojo’s Pod</div>
  <nav style="margin-left:auto;color:var(--muted)"><a href="#" style="color:inherit;text-decoration:none;margin-left:12px">About</a></nav>
</header>

<div class="controls">
  <div class="filters" role="tablist" aria-label="filters">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="pod">Podcast</button>
    <button class="filter-btn" data-filter="print">Prints</button>
    <button class="filter-btn" data-filter="paint">Paintings</button>
  </div>
</div>

<main class="container">
  <div class="grid" id="grid">
    <!-- 示例卡片：替换为你的缩略图（建议 500px 宽），并加 loading="lazy" 与宽高或 srcset -->
    <article class="card pod">
      <img loading="lazy" src="https://picsum.photos/id/1015/900/900" alt="Ep6" width="900" height="900">
      <div class="meta"><span class="badge pod">Podcast</span><span>Ep.6</span></div>
      <h3 class="title">Spiral to the Universe ~ 和弦陀螺</h3>
      <p class="desc">一段短小的音像实验：从五度链到对数螺线，轻轻旋转。</p>
    </article>

    <article class="card pod">
      <img loading="lazy" src="https://picsum.photos/id/1005/700/700" alt="Ep5" width="700" height="700">
      <div class="meta"><span class="badge pod">Podcast</span><span>Ep.5</span></div>
      <h3 class="title">从薛定谔到一块橡皮章</h3>
      <p class="desc">关于物理、手作与记忆的小段思考。</p>
    </article>

    <article class="card print">
      <img loading="lazy" src="https://picsum.photos/id/1025/800/1200" alt="Print" width="800" height="1200">
      <div class="meta"><span class="badge print">Print</span><span>Print 01</span></div>
      <h3 class="title">铭记 · θεὸν περιφέρεις</h3>
      <p class="desc">书签与木刻的短辑，纪念性的图像小物。</p>
    </article>

    <article class="card paint">
      <img loading="lazy" src="https://picsum.photos/id/1048/900/1100" alt="Painting" width="900" height="1100">
      <div class="meta"><span class="badge paint">Painting</span><span>Work A</span></div>
      <h3 class="title">二次生长 · 再生的姿态</h3>
      <p class="desc">亚麻布上的小画，关于时间与复苏。</p>
    </article>

    <!-- 继续添加更多 card -->
  </div>
</main>

<footer style="padding:30px 20px;text-align:center;color:var(--muted)">© Jojo’s Pod — sound · print · painting</footer>

<script>
/* 精简可用的高效布局脚本（用途：为 grid 中的 card 计算 grid-row-span） */
/* 要点：只在图片加载后计算（支持 lazy）、用 rAF 批写、resize 防抖、忽略 hidden 卡片 */

(function(){
  const grid = document.getElementById('grid');
  if (!grid) return;

  const docStyle = getComputedStyle(document.documentElement);
  const baseRow = parseFloat(docStyle.getPropertyValue('--row-h')) || 8;
  const gap = parseFloat(getComputedStyle(grid).getPropertyValue('gap')) || 18;

  // 用 rAF 批量写
  let writeQueue = [];
  function scheduleWrite(fn){
    writeQueue.push(fn);
    if (writeQueue.length === 1){
      requestAnimationFrame(() => {
        const q = writeQueue.slice(); writeQueue = [];
        q.forEach(f => { try { f(); } catch(e){console.error(e);} });
      });
    }
  }

  function computeSpanFor(card){
    if (card.classList.contains('hidden')) return;
    // read
    const height = Math.ceil(card.getBoundingClientRect().height);
    const span = Math.max(1, Math.ceil((height + gap) / (baseRow + gap)));
    scheduleWrite(() => { card.style.gridRowEnd = 'span ' + span; });
  }

  function layoutAllVisible(){
    const cards = Array.from(grid.querySelectorAll('.card')).filter(c => !c.classList.contains('hidden'));
    cards.forEach(computeSpanFor);
  }

  // 图片加载时单张计算其 card（更高效）
  function bindImgs(){
    const imgs = grid.querySelectorAll('img');
    imgs.forEach(img => {
      if (img.__bound) return;
      img.__bound = true;
      if (img.complete) {
        const card = img.closest('.card'); if (card) computeSpanFor(card);
      } else {
        img.addEventListener('load', () => { const card = img.closest('.card'); if (card) computeSpanFor(card); }, {passive:true});
        img.addEventListener('error', () => { const card = img.closest('.card'); if (card) computeSpanFor(card); }, {passive:true});
      }
    });
  }

  // 初始绑定与延迟二次布局（字体/渲染稳定）
  window.addEventListener('load', () => {
    bindImgs();
    // allow initial paints then compute all
    setTimeout(layoutAllVisible, 120);
  });

  // resize 防抖
  let rTimer;
  window.addEventListener('resize', () => {
    clearTimeout(rTimer);
    rTimer = setTimeout(() => {
      layoutAllVisible();
    }, 140);
  }, {passive:true});

  // MutationObserver：当卡片隐藏/显示（筛选）或 DOM 改变时，重新绑定/布局
  const mo = new MutationObserver(muts => {
    let changed = false;
    for (const m of muts) { if (m.type === 'childList' || m.type === 'attributes') { changed = true; break; } }
    if (changed) { bindImgs(); setTimeout(layoutAllVisible, 60); }
  });
  mo.observe(grid, {childList:true, subtree:true, attributes:true, attributeFilter:['class']});

  // filter buttons logic (assumes buttons in .filters)
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const f = btn.getAttribute('data-filter');
      grid.querySelectorAll('.card').forEach(c => {
        c.classList.remove('hidden');
        if (f !== 'all' && !c.classList.contains(f)) c.classList.add('hidden');
      });
      // small delay to allow display change
      setTimeout(layoutAllVisible, 80);
    });
  });
})();
</script>
</body>
</html>
