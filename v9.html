<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Jojo’s Pod — Adaptive Masonry Grid</title>
<style>
  :root{
    --bg:#f7f5f2;
    --accent:#144055;
    --muted:#666;
    --gap:18px;
    --min-col:240px; /* 调整这个值可以改变最小列宽，从而影响列数 */
    --row-height:8px; /* grid-auto-rows 的基准高度（px） */
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family: Inter, "Noto Sans SC", system-ui, -apple-system, "Helvetica Neue", Arial;
    background:var(--bg); color:#222;
  }

  header{
    padding:20px; display:flex; align-items:center; gap:12px; border-bottom:1px solid rgba(0,0,0,0.04);
  }
  .logo{font-weight:700;color:var(--accent)}
  .hero{max-width:1200px;margin:18px auto;padding:12px 20px}
  .hero h1{margin:0;color:var(--accent);font-size:20px}
  .hero p{margin:6px 0 0;color:var(--muted)}

  .controls{max-width:1200px;margin:12px auto;padding:6px 20px;display:flex;align-items:center}
  .filters{display:flex;gap:8px;flex-wrap:wrap}
  .filters button{
    padding:8px 12px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);
    background:#fff;cursor:pointer;font-size:13px;color:var(--muted);
  }
  .filters button.active{color:var(--accent);border-color:var(--accent);font-weight:600}

  /* ========== Grid container ========== */
  .masonry-wrap{max-width:1400px;margin:0 auto;padding:0 20px 80px;}
  .masonry{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(var(--min-col), 1fr));
    gap: var(--gap);
    grid-auto-rows: calc(var(--row-height) * 1px); /* JS 用此值来计算跨行数量 */
    align-items: start;
  }

  /* card */
  .card{
    background:#fff;border-radius:12px;overflow:hidden;
    box-shadow: 0 6px 20px rgba(15,43,61,0.04);
    border:1px solid rgba(0,0,0,0.03);
    transition: transform .35s cubic-bezier(.2,.8,.2,1), box-shadow .35s ease;
    display:flex;flex-direction:column;
  }
  .card:hover{transform:translateY(-8px);box-shadow:0 18px 40px rgba(15,43,61,0.09);}

  .thumb{display:block;width:100%;}
  .card img{display:block;width:100%;height:auto;transition:transform .7s ease;}
  .card:hover img{transform:scale(1.03);}

  .meta{padding:12px 14px;display:flex;justify-content:space-between;align-items:center;font-size:13px;color:var(--muted);}
  .title{margin:0;padding:0 14px 8px;color:var(--accent);font-size:16px}
  .desc{margin:0;padding:0 14px 18px;color:#333;font-size:14px;line-height:1.45}

  .badge{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;color:#fff}
  .pod{background:#2b6fa3}
  .print{background:#b56a45}
  .paint{background:#4a8a5e}

  .hidden{display:none !important;}

  footer{padding:36px 20px;text-align:center;color:var(--muted);font-size:13px}

  /* small screen tweaks */
  @media (max-width:700px){
    :root{--min-col:180px} /* 更小屏时减小最小列宽帮助多列出现 */
  }
</style>
</head>
<body>

<header>
  <div class="logo">Jojo’s Pod</div>
  <nav style="margin-left:auto;color:var(--muted)"><a href="#" style="color:inherit;text-decoration:none;margin-left:12px">About</a></nav>
</header>

<section class="hero">
  <h1>Jojo’s Works — sound · print · painting</h1>
  <p>Three rhythms of one inquiry — browse experiments, prints and paintings.</p>
</section>

<div class="controls">
  <div class="filters" role="tablist" aria-label="filter">
    <button class="filter-btn active" data-filter="all">All</button>
    <button class="filter-btn" data-filter="pod">Podcast</button>
    <button class="filter-btn" data-filter="print">Printworks</button>
    <button class="filter-btn" data-filter="paint">Paintings</button>
  </div>
</div>

<div class="masonry-wrap">
  <div class="masonry" id="masonry">
    <!-- 示例卡片（替换图片与文本） -->
    <article class="card pod">
      <img class="thumb" src="https://picsum.photos/seed/ep6/900/900" alt="Ep6 Spiral">
      <div class="meta"><span class="badge pod">Podcast</span><span>Ep.6</span></div>
      <h3 class="title">Spiral to the Universe ~ 和弦陀螺</h3>
      <p class="desc">一段短小的音像实验：从五度链到对数螺线，轻轻旋转。</p>
    </article>

    <article class="card pod">
      <img class="thumb" src="https://picsum.photos/seed/ep5/700/700" alt="Ep5">
      <div class="meta"><span class="badge pod">Podcast</span><span>Ep.5</span></div>
      <h3 class="title">从薛定谔到一块橡皮章</h3>
      <p class="desc">关于物理、手作与记忆的小段思考。</p>
    </article>

    <article class="card print">
      <img class="thumb" src="https://picsum.photos/seed/print1/800/1200" alt="Print1">
      <div class="meta"><span class="badge print">Print</span><span>Print 01</span></div>
      <h3 class="title">铭记 · θεὸν περιφέρεις</h3>
      <p class="desc">书签与木刻的短辑，纪念性的图像小物。</p>
    </article>

    <article class="card paint">
      <img class="thumb" src="https://picsum.photos/seed/paint1/900/1100" alt="Paint1">
      <div class="meta"><span class="badge paint">Painting</span><span>Work A</span></div>
      <h3 class="title">二次生长 · 再生的姿态</h3>
      <p class="desc">亚麻布上的小画，关于时间与复苏。</p>
    </article>

    <!-- 更多 card 放在这里 -->
  </div>
</div>

<footer>© Jojo’s Pod — sound · print · painting</footer>

<script>
/* ========== 核心布局脚本：根据元素实际高度计算 grid-row 跨度 ========== */
/* 说明：
   - grid-auto-rows 在 CSS 中设置为 --row-height px（通过 calc）
   - JS 读取元素高度（包括 margin/gap 的影响），计算需要占多少行： span = Math.ceil((height + gap) / (rowHeight + gap))
   - 这样既能保持响应式列数（由 auto-fill 决定），又实现瀑布式视觉效果
*/

const grid = document.getElementById('masonry');
const baseRow = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--row-height')) || 8;

function layoutMasonry() {
  const gap = parseFloat(getComputedStyle(grid).getPropertyValue('gap')) || 18;
  const items = Array.from(grid.querySelectorAll('.card')).filter(i => !i.classList.contains('hidden'));
  items.forEach(item => {
    item.style.gridRowEnd = null; // reset
    // getBoundingClientRect 用于精确高度（包含实际渲染高度）
    const itemHeight = item.getBoundingClientRect().height;
    // include one gap for safer spacing
    const rowSpan = Math.ceil((itemHeight + gap) / (baseRow + gap));
    item.style.gridRowEnd = 'span ' + rowSpan;
  });
}

// 等图片加载完再布局
function imagesLoadedLayout() {
  const imgs = grid.querySelectorAll('img');
  let count = 0;
  if (imgs.length === 0) { layoutMasonry(); return; }
  imgs.forEach(img => {
    if (img.complete) count++;
    else {
      img.addEventListener('load', () => { count++; if (count === imgs.length) layoutMasonry(); });
      img.addEventListener('error', () => { count++; if (count === imgs.length) layoutMasonry(); });
    }
  });
  if (count === imgs.length) layoutMasonry();
}

// 初次与重绘时布局
window.addEventListener('load', () => {
  imagesLoadedLayout();
  // 字体或渲染微调后再一次布局
  setTimeout(layoutMasonry, 250);
});
let t;
window.addEventListener('resize', () => {
  clearTimeout(t);
  t = setTimeout(layoutMasonry, 120);
});

// 过滤逻辑
document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const f = btn.getAttribute('data-filter');
    const items = grid.querySelectorAll('.card');
    items.forEach(it => {
      it.classList.remove('hidden');
      if (f !== 'all' && !it.classList.contains(f)) it.classList.add('hidden');
    });
    // 重新布局（小延迟让 display 生效）
    setTimeout(() => { imagesLoadedLayout(); }, 80);
  });
});
</script>

</body>
</html>
